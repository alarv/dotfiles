#
# Docker
#
function dk {
    CONT=$@
    if [[ $CONT == lib_* ]]
    then
        docker kill $CONT
    elif [[ -z $CONT ]]
    then
	docker kill `dps | fzf`
    else
        CONT+=_1
        docker kill "lib_$CONT"
    fi
}

function dl {
    CONT=$@
    if [[ $CONT == lib_* ]]
    then
        docker logs $CONT
    elif [[ -z $CONT ]]
    then
	docker logs `dps | fzf`
    else
        CONT+=_1
        docker logs "lib_$CONT"
    fi
}

function dps {
    if [ -z "$@" ]
    then
	    docker ps | awk '{ print $NF }' | tail -n +2
    else
	    docker ps | awk '{ print $NF }' | tail -n +2 | grep --color=always -i $@
    fi
}

function de {
    CONT=$@
    if [[ $CONT == lib_* ]]
    then
        docker exec -ti $CONT bash
    elif [[ -z $CONT ]]
    then
	docker exec -ti `dps | fzf` bash
    else
        CONT+=_1
        docker exec -ti "lib_$CONT" bash
    fi
}

function db {
    NAME=`cat docker/NAME`
    if [ -z "$NAME" ]
    then
	    docker build .
    else
	    docker build -t $NAME .
    fi
}

# Restart a container
function dr {
    WD=`pwd`
    cd /home/eyeos/src/eyeos-single-node-fig/lib/ &> /dev/null

    CONT=$@
    if [[ -z $CONT ]]; then
	CONT=`dps | fzf | sed 's/lib_//' | sed 's/_1//'`
    fi
    docker-compose kill $CONT
    docker-compose rm --force $CONT
    docker-compose up -d $CONT
    cd $WD &> /dev/null
}

# Stop all containers
dstop-all() { docker stop $(docker ps -a -q); }
dkill-all() { docker kill $(docker ps -a -q); }

# Remove all containers
drm-all() { docker rm $(docker ps -a -q); }
