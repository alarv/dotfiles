#!/bin/bash

#
# Docker
#
function dk {
    CONTAINER=`dps | fzf -1 -0 -q $@` 
    docker kill $CONTAINER
}

function dl {
    CONTAINER=`dps | fzf -1 -0 -q $@` 
    docker logs $CONTAINER
}

function dlf {
    CONTAINER=`dps | fzf -1 -0 -q $@` 
    docker logs -f $CONTAINER
}

function dps {
    if [ -z "$@" ]
    then
	    docker ps | awk '{ print $NF }' | tail -n +2
    else
	    docker ps | awk '{ print $NF }' | tail -n +2 | grep --color=always -i $@
    fi
}

function de {
    CONTAINER=`dps | fzf -1 -0 -q $@` 
    docker exec -ti $CONTAINER bash
}

function db {
    NAME=`cat docker/NAME`
    if [ -z "$NAME" ]
    then
	    docker build .
    else
	    docker build -t $NAME .
    fi
}

# Restart a container
function dr {
    WD=`pwd`
    cd /home/eyeos/src/eyeos-single-node-fig/lib/ &> /dev/null

    CONT=`dps | fzf -q $@ -1 -0 | sed 's/lib_//' | sed 's/_1//'`
    if [[ -z $CONT ]]; then
	return
    fi
    docker-compose kill $CONT
    docker-compose rm --force $CONT
    docker-compose up -d $CONT

    cd $WD &> /dev/null
}

# Stop all containers
dstop-all() { docker stop $(docker ps -a -q); }
dkill-all() { docker kill $(docker ps -a -q); }

# Remove all containers
drm-all() { docker rm $(docker ps -a -q); }
